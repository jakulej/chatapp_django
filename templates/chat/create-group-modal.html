<!-- <div id="modal-create-group" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50">
    <h3>Create Group</h3>
    <div id="modal-create-group-user-friends">
    {% for friend in request.user.friends.all %}
        {% include "chat/create-group-modal-record.html" with username=friend.username %}
    {% endfor %}
    </div>
    <button id="modal-create-group-button-submit" data-username="{{ username }}">Create Group</button>
</div> -->



<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in fade-in duration-200">
  <div data-slot="card" class="bg-white text-[#232323] flex flex-col gap-6 rounded-xl py-6 shadow-sm w-full max-w-lg border border-[#232323] animate-in zoom-in-95 duration-200">
    
    <!-- Header -->
    <div class="p-6 border-b border-[#232323]">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-[#232323]">Create Group Chat</h3>
        <button id="add-group-close-modal" class="inline-flex items-center justify-center rounded-md size-9 text-sm font-medium text-[#232323] hover:bg-accent hover:text-accent-foreground disabled:opacity-50">
            {% include "chat/icons/close-icon.html" %}
        </button>
      </div>

      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-[#232323]">Group Name</label>
          <input id="create-group-name" placeholder="Enter group name" value=""
            class="mt-1 w-full rounded-md border border-[#232323] bg-[#f8f5f2] px-3 py-1 text-base text-[#222525] shadow-xs focus-visible:ring-2 focus-visible:ring-ring/50 h-9" />
        </div>
      </div>
    </div>

    <!-- Members -->
    <div class="p-6 max-h-80 overflow-y-auto">
      <div class="space-y-4">
        <div>
          <label class="text-sm font-medium text-[#232323]">Add Members</label>
          <div class="relative mt-1">
            {% include "chat/icons/maginfire-icon.html" %}
            <input placeholder="Search friends to add" value=""
              class="pl-10 w-full rounded-md border border-[#232323] bg-[#f8f5f2] px-3 py-1 text-base text-[#222525] shadow-xs h-9" />
          </div>
        </div>
            {% for friend in request.user.friends.all %}
                {% include "chat/create-group-modal-record.html" with username=friend.username %}
            {% endfor %}

        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="p-6 border-t border-[#232323]">
      <div class="flex gap-2">
        <button id="modal-create-group-button-submit"
          class="flex-1 rounded-md border border-[#232323] bg-transparent text-[#232323] px-4 py-2 h-9 text-sm font-medium shadow-xs hover:bg-[#078080] hover:cursor-pointer">
          Create Group
        </button>
        <button id="modal-create-group-cancel" class="flex-1 rounded-md border border-[#232323] bg-transparent text-[#232323] px-4 py-2 h-9 text-sm font-medium shadow-xs hover:bg-[#F45D48] hover:cursor-pointer">
        Cancel
        </button>



<script>
    const requestUrl = '{% url 'chat:createRoom' %}'
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        document.getElementById('modal-create-group-button-submit').addEventListener('click' , async function(e) {
            const checked = document.querySelectorAll('.modal-create-group-friend-record-checbox:checked');
            const values = Array.from(checked).map( checkbox => checkbox.dataset.username);
            const groupName = document.getElementById('create-group-name').value;
            

            try {
                const response = await fetch(requestUrl,{
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({ users: values, group_name: groupName })
                });
                if (!response.ok) {
                    throw new Error(`Response status: ${response.status}`);
                }else {
                    //Message: Room created sucesfully
                    window.location.href = '/chat/';
                }
            } catch (error) {
                console.error(error.message);
            }

        });

</script>
